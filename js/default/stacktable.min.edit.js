(function($){$.fn.stacktable=function(options){var $tables=this,defaults={id:"stacktable small-only",hideOriginal:true},settings=$.extend({},defaults,options);return $tables.each(function(){var $stacktable=$('<table class="'+settings.id+'"><tbody></tbody></table>');if(typeof settings.myClass!==undefined){$stacktable.addClass(settings.myClass)}var markup="";$table=$(this);$table.addClass("stacktable large-only");$topRow=$table.find("tr").eq(0);$table.find("tr").each(function(index,value){markup+="<tr>";if(index===0){markup+='<tr><th class="st-head-row st-head-row-main" colspan="2">'+$(this).find("th,td").eq(0).html()+"</th></tr>"}else{$(this).find("td,th").each(function(index,value){if(index===0){markup+='<tr><th class="st-head-row" colspan="2">'+$(this).html()+"</th></tr>"}else{if($(this).html()!==""){markup+="<tr>";if($topRow.find("td,th").eq(index).html()){markup+='<td class="st-key">'+$topRow.find("td,th").eq(index).html()+"</td>"}else{markup+='<td class="st-key"></td>'}markup+='<td class="st-val">'+$(this).html()+"</td>";markup+="</tr>"}}})}});$stacktable.append($(markup));$table.before($stacktable);if(!settings.hideOriginal){$table.show()}})};$.fn.stackcolumns=function(options){var $tables=this,defaults={id:"stacktable small-only",hideOriginal:true},settings=$.extend({},defaults,options);return $tables.each(function(){$table=$(this);var num_cols=$table.find("tr").eq(0).find("td,th").length;if(num_cols<3){return}var $stackcolumns=$('<table class="'+settings.id+'"></table>');if(typeof settings.myClass!==undefined){$stackcolumns.addClass(settings.myClass)}$table.addClass("stacktable large-only");var tb=$("<tbody></tbody>");var col_i=1;while(col_i<num_cols){$table.find("tr").each(function(index,value){var tem=$("<tr></tr>");if(index==0){tem.addClass("st-head-row st-head-row-main")}first=$(this).find("td,th").eq(0).clone().addClass("st-key");var target=col_i;if($(this).find("*[colspan]").length){var i=0;$(this).find("td,th").each(function(index,value){var cs=$(this).attr("colspan");if(cs){cs=parseInt(cs,10);target-=cs-1;if((i+cs)>(col_i)){target+=i+cs-col_i-1}i+=cs}else{i++}if(i>col_i){return false}})}second=$(this).find("td,th").eq(target).clone().addClass("st-val").removeAttr("colspan");tem.append(first,second);tb.append(tem)});++col_i}$stackcolumns.append($(tb));$table.before($stackcolumns);if(!(settings.hideOriginal)){$table.show()}})}}(jQuery));

// инициализация
$(function(){$('.js-stacktable').stacktable()});